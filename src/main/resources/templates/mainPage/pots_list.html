<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/_variables.css">
    <link rel="stylesheet" type="text/css" href="/css/_bootswatch.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/minty/bootstrap.min.css" integrity="sha384-H4X+4tKc7b8s4GoMrylmy2ssQYpDHoqzPa9aKXbDwPoPUA3Ra8PA5dGzijN+ePnH" crossorigin="anonymous">
    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <style>

        .outer {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* 여백 추가 */
            justify-content: center; /* 가로 중앙 정렬 */
            align-items: center; /* 세로 중앙 정렬 */
        }

        .card {
            flex-basis: 33.33%;
            box-sizing: border-box;
        }
        .card:hover{
            border-width: thick;
        }

    </style>
    <script>
        function handleOuterClick(potId) {
            window.location.href = "/pot/" + potId;
        }


       /* const clickLikeUrl = "/image/like/full.png";
        const emptyLikeUrl = "/image/like/empty.png";

        /!** 좋아요 유무에 따라 하트 그림 다르게 보여줌 **!/
        //브라우저가 웹 문서를 읽기 시작하고 DOM이 생성되면 실행되는 메소드
        $(function(){

            // 현재 로그인한 유저가 해당 게시물을 좋아요 했다면 likeVal = true,
            // 좋아요하지 않았다면 false
            let likeVal = $('#like_check').val(); // 데이터가 있으면 true
            const likeImg = $('#likeImg');

            console.log("likeVal : " + likeVal);

            if(likeVal === 'true'){
                // 데이터가 존재하면 화면에 채워진 하트 보여줌
                $('#likeImg').attr("src", clickLikeUrl);
            } else if(likeVal === 'false'){
                // 데이터가 없으면 화면에 빈 하트 보여줌
                $('#likeImg').attr("src", emptyLikeUrl);
            }
        });

        /!** 좋아요 클릭 시 실행 **!/
        $('#likeImg').click(function() {

            const postId = $('#postId').val();
            const likeVal = $('#like_check').val();

            console.log(likeVal);
            if (likeVal === 'true') {
                const con_check = confirm("현재 게시물 추천을 취소하시겠습니까?")
                if (con_check) {
                    console.log("추천 취소 진입");
                    $.ajax({
                        type: 'POST',
                        url: '/rest/community/post/like/' + postId,
                        contentType: 'application/json; charset=utf-8'
                    }).done(function () {
                        $('#likeImg').attr("src", emptyLikeUrl);
                        location.reload();
                    }).fail(function (error) {
                        alert(JSON.stringify(error));
                    })
                }
            } else if(likeVal === 'false'){
                const con_check = confirm("현재 게시물을 추천하시겠습니까?");
                if (con_check) {
                    console.log("추천 진입");
                    $.ajax({
                        type: 'POST',
                        url: '/rest/community/post/like/' + postId,
                        contentType: 'application/json; charset=utf-8'
                    }).done(function () {
                        $('#likeImg').attr("src", clickLikeUrl);
                        location.reload();
                    }).fail(function (error) {
                        alert(JSON.stringify(error));
                    })
                }
            }
        });

        /!** 로그인하지 않은 유저가 좋아요 누를 때 **!/
        $('#loginCheck').click(function(){
            alert("로그인 후 이용할 수 있습니다.");
        });*/
    </script>

</head>
<body>
<th:block th:if="${potSearchForm.searchText!=null}">
   <div style="text-align:center"><h3 th:text="${potSearchForm.searchText}+' 검색 결과입니다.'"/></div>
</th:block>
<th:block th:if="${potList.getSize()==0 || potList == null}">
    <div style="text-align:center"><h3>검색 결과가 없습니다.</h3></div>
</th:block>
<div th:label="potList" class="outer">
    <div th:each="pot, stat : ${potList}" class="card border-primary mb-3" style="max-width: 20rem;">
        <div class="row-md-4" th:onclick="'handleOuterClick(\'' + ${pot.potId} + '\')'" >
            <div class="card-header" th:text="${pot.potName}"></div>
            <div class="card-header" th:text="${pot.ottType}"></div>

            <div class="card-body">
                <!--<div sec:authorize-expr="isAuthenticated()" or th:unless="${#strings.equals(post.getMember_id(),login_id)}" class="d-block">
                    &lt;!&ndash; 로그인 유저와 작성자가 동일하지 않다면 &ndash;&gt;
                    &lt;!&ndash; 좋아요 &ndash;&gt;
                    <input type="hidden" id="like_check" th:value="${like}">
                    <img th:id="likeImg" src="/image/like/empty.png" alt="" width="30px"
                         height="30px">

                    <span th:text="${post.likeCount}"></span>
                </div>-->
                <p class="card-title" th:text="'모집인원 : ' + ${pot.recruit}"></p>
                <p class="card-title" th:text="'현재인원 : ' + (${pot.recruit} - ${pot.remain})"></p>
                <p class="card-title" th:text="'기간 : ' + ${pot.term}"></p>
            </div>
        </div>
    </div>
</div>
</body>
</html>